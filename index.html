<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>陳宏麟診所｜身高估算計算器</title>
  <link rel="icon" href="favicon.ico">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#2F5579">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="陳宏麟診所">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <style>
    :root { --brand:#2F5579; --accent:#9AC43C; --bg:#fffaf5; --card:#ffffff; }
    html,body{height:100%;}
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC","微軟正黑體","Segoe UI",Arial,sans-serif;background:var(--bg);}
    header{display:flex;gap:12px;align-items:center;padding:max(env(safe-area-inset-top),14px) 16px;background:var(--card);
            position:sticky;top:0;z-index:5;box-shadow:0 2px 10px rgba(0,0,0,.05);}
    header img{width:36px;height:36px;border-radius:8px;object-fit:contain;border:1px solid #eef0f3;background:#fff;}
    header .title{font-weight:800;color:var(--brand);}
    main{max-width:640px;margin:0 auto;padding:16px;display:flex;flex-direction:column;gap:14px;}
    .card{background:var(--card);border-radius:16px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,.06);}
    label{display:block;font-size:14px;margin:8px 0 6px;opacity:.85;}
    select,input{width:100%;padding:12px;border:1px solid #dcdcdc;border-radius:12px;font-size:16px;background:#fff;}
    .seg{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:4px;}
    .seg button{padding:12px;border-radius:12px;border:1px solid #e5e5e5;background:#fff;font-size:16px;cursor:pointer;}
    .seg button.active{background:var(--brand);color:#fff;border-color:var(--brand);}
    .result{position:sticky;bottom:0;padding:16px;background:linear-gradient(180deg, rgba(255,250,245,0), rgba(255,250,245,1) 40%);}
    .result .box{background:var(--accent);color:#123;padding:18px;border-radius:16px;text-align:center;font-size:20px;font-weight:800;}
    footer{text-align:center;font-size:12px;opacity:.6;padding:12px 0 24px;}
    .cta{margin-top:8px;width:100%;padding:12px;font-size:16px;background:#2B2B2B;color:#fff;border:none;border-radius:12px;display:none;}
  </style>
</head>
<body>
  <header>
    <img src="icons/icon-192.png" alt="Clinic logo">
    <div class="title">陳宏麟診所｜身高估算計算器</div>
  </header>

  <main>
    <section class="card">
      <div class="seg" role="tablist" aria-label="方法選擇">
        <button id="btn-knee" class="active" aria-selected="true">膝長法</button>
        <button id="btn-demi" aria-selected="false">半臂展法</button>
      </div>

      <label for="gender">性別</label>
      <select id="gender">
        <option value="M">男性</option>
        <option value="F">女性</option>
      </select>

      <div id="knee-group">
        <label for="age">年齡（歲）</label>
        <input id="age" type="number" inputmode="decimal" placeholder="例如 75" />
        <label for="knee">膝長 KH（cm）</label>
        <input id="knee" type="number" inputmode="decimal" placeholder="例如 50.2" />
      </div>

      <div id="demi-group" style="display:none;">
        <label for="demispan">半臂展（cm）</label>
        <input id="demispan" type="number" inputmode="decimal" placeholder="例如 80.0" />
      </div>
    </section>

    <section class="result">
      <div class="box" id="out">輸入數值以顯示估算身高</div>
      <button class="cta" id="installBtn">安裝到主畫面（離線可用）</button>
    </section>

    <footer>© 陳宏麟診所　公式：Knee height / Demispan 臨床估算式</footer>
  </main>

<script>
  let deferredPrompt;
  const installBtn = document.getElementById('installBtn');
  window.addEventListener('beforeinstallprompt', (e)=>{ e.preventDefault(); deferredPrompt = e; installBtn.style.display='block'; });
  installBtn.addEventListener('click', async ()=>{ if(!deferredPrompt) return; deferredPrompt.prompt(); await deferredPrompt.userChoice; deferredPrompt=null; installBtn.style.display='none'; });

  if ('serviceWorker' in navigator) { window.addEventListener('load', ()=>{ navigator.serviceWorker.register('./sw.js'); }); }

  const btnKnee = document.getElementById('btn-knee');
  const btnDemi = document.getElementById('btn-demi');
  const kneeGroup = document.getElementById('knee-group');
  const demiGroup = document.getElementById('demi-group');
  const out = document.getElementById('out');

  function setMode(mode){
    const isKnee = mode === 'knee';
    btnKnee.classList.toggle('active', isKnee);
    btnDemi.classList.toggle('active', !isKnee);
    kneeGroup.style.display = isKnee ? 'block' : 'none';
    demiGroup.style.display = isKnee ? 'none' : 'block';
    calc();
  }
  btnKnee.addEventListener('click', ()=>setMode('knee'));
  btnDemi.addEventListener('click', ()=>setMode('demi'));

  ['gender','age','knee','demispan'].forEach(id=>{ const el=document.getElementById(id); if(el) el.addEventListener('input', calc); });

  function num(v){ const n=parseFloat(v); return isNaN(n)?null:n; }
  function calc(){
    const gender = document.getElementById('gender').value;
    const age = num(document.getElementById('age')?.value);
    const knee = num(document.getElementById('knee')?.value);
    const demi = num(document.getElementById('demispan')?.value);
    const isKnee = kneeGroup.style.display !== 'none';
    let h = null;
    if (isKnee){ if(age!=null && knee!=null) h = (gender==='M')? (64.19 - 0.04*age + 2.02*knee) : (84.88 - 0.24*age + 1.83*knee); }
    else { if(demi!=null) h = (gender==='M')? (1.40*demi + 57.8) : (1.35*demi + 60.1); }
    out.textContent = (h==null) ? "輸入數值以顯示估算身高" : ("估算身高：約 " + h.toFixed(1) + " cm");
  }
  calc();
</script>
</body>
</html>
